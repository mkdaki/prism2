# Prism PoC 実装タスクチェックリスト

（2025/12/28 時点）

## フェーズA：PoCを「操作可能」にする必須タスク

### A-0. 品質・土台（先に整備）

* [ ] A-0-1. CORS を設定
    * [ ] 例：`http://localhost:3001` を許可
    * [ ] 許可オリジンは環境変数で切替できるようにする
* [ ] A-0-2. テスト基盤を追加
    * [ ] `pytest` / FastAPI TestClient
    * [ ] カバレッジ計測（80%以上を維持）
* [ ] A-0-3. CI を追加
    * [ ] Backend：テスト + coverage 80%以上
    * [ ] Frontend：build を実行
* [ ] A-0-4. Alembic 方針決定
    * [ ] Alembic を導入し、起動時 `create_all` 依存を解消する方針を決める
    * [ ] フェーズAでは「方針決定」まででも可（導入作業はフェーズBに寄せても良い）

---

### A-1. データセット一覧取得 API

* [ ] `GET /datasets` エンドポイントを実装
* [ ] `datasets` テーブルから一覧取得
* [ ] 各 dataset について以下を返却

  * [ ] dataset_id
  * [ ] filename
  * [ ] created_at
  * [ ] 行数（`dataset_rows` の COUNT）
* [ ] レスポンス形式を JSON として確定
* [ ] Swagger（/docs）で確認
* [ ] ユニットテストを追加（正常系：0件/複数件、行数COUNTが返ること）

---

### A-2. データセット詳細取得 API

* [ ] `GET /datasets/{dataset_id}` を実装
* [ ] 指定 dataset_id の存在チェック
* [ ] 以下の情報を返却

  * [ ] メタ情報（filename / created_at）
  * [ ] 行数
  * [ ] JSONB データのサンプル（先頭 N 行）
* [ ] サンプル件数を固定値（例：10件）にする
* [ ] エラー時のレスポンスを定義（404 等）
* [ ] ユニットテストを追加（正常系、異常系：存在しないIDで404）

---

### A-3. フロントエンド：CSVアップロード機能

* [ ] CSVアップロード用画面を作成
* [ ] `<input type="file">` を配置
* [ ] `POST /datasets/upload` を呼び出す処理を実装
* [ ] 成功時レスポンス（dataset_id / 行数）を画面表示
* [ ] エラー時の最低限の表示（alert 等）
* [ ] ユニットテストを追加（少なくともAPI呼び出し処理を関数化してテスト）

---

## フェーズB：分析 PoC としての中核機能

### B-0. 品質・土台（分析機能の前に）

* [ ] Alembic を導入し、初期マイグレーションを作成（`datasets` / `dataset_rows`）
* [ ] 起動時の `create_all` を削除（DBスキーマはマイグレーションで管理）
* [ ] CI にマイグレーション適用（例：テストDBに `alembic upgrade head`）を組み込む

---

### B-1. 最小集計（統計）API

* [ ] `GET /datasets/{dataset_id}/stats` を実装
* [ ] 対象 dataset の行数を算出
* [ ] JSONB からカラム一覧を抽出
* [ ] 数値カラムについて以下を算出（可能な範囲で）

  * [ ] min
  * [ ] max
  * [ ] avg
* [ ] 集計結果を JSON で返却
* [ ] 計算不可カラムは除外（PoC割り切り）
* [ ] ユニットテストを追加（数値/非数値/欠損の混在を含む最低限のパターン）

---

### B-2. LLM 簡易分析 API

* [ ] 集計結果（B-1）を入力とする処理を実装
* [ ] LLM 用プロンプトをコード内に定義
* [ ] 「注目点 / 仮説」をテキスト生成
* [ ] `GET /datasets/{dataset_id}/analysis` 等で提供
* [ ] 出力は保存せず都度生成（PoC割り切り）
* [ ] ユニットテストを追加（LLM呼び出しはスタブ/モックし、プロンプト組み立てとレスポンス整形を検証）

---

## フェーズC：管理画面として最低限成立させる

### C-0. 品質・土台（画面機能の前に）

* [ ] フロントのCIを整備（`npm ci` → `npm run build`）
* [ ] フロントの簡易テスト導入（最低限のレンダリング/ロジックのテスト。テスト方式はここで確定）

---

### C-1. データセット一覧画面

* [ ] 起動時に `GET /datasets` を呼び出す
* [ ] データセット一覧をテーブル表示
* [ ] dataset_id をクリック可能にする
* [ ] 選択時に詳細画面へ遷移
* [ ] ユニットテストを追加（一覧表示・エラー表示の最低限）

---

### C-2. データセット詳細・分析画面

* [ ] 詳細 API（A-2）の結果を表示
* [ ] 集計 API（B-1）の結果を表示
* [ ] LLM 分析結果（B-2）を表示
* [ ] レイアウトは最小限（装飾不要）
* [ ] ユニットテストを追加（詳細取得失敗時の表示、主要コンポーネントが落ちないこと）

---

### C-3. 簡易グラフ表示（任意）

* [ ] グラフライブラリを 1 つ選定
* [ ] 件数 or 数値分布を 1 種類表示
* [ ] 見た目より「動くこと」を優先

---

## フェーズD：安定性・PoC品質の底上げ（後回し可）

* [ ] CSV の文字コードエラー対策（UTF-8前提明示）
* [ ] 空 CSV / 不正 CSV のエラーハンドリング
* [ ] Backend ログの粒度整理
* [ ] README に「PoCでやらないこと」を再明示

---

## PoC完了チェック（Done 定義との照合）

* [ ] CSV をブラウザからアップロードできる
* [ ] PostgreSQL にデータが格納される
* [ ] 集計結果を API で取得できる
* [ ] LLM の分析コメントが生成される
* [ ] すべてを画面上で確認できる

---